<!DOCTYPE html>
<html>
  <head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js" integrity="sha512-L5K9Bf852XyB+wrvRFGwWzfhVI+TZqJlgwzX9yvrfhILuzIZfrcQO4au9D9eVDnkQ6oqYr9v2QwJdFo+eKE50Q==" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js" integrity="sha512-tAGcCfR4Sc5ZP5ZoVz0quoZDYX5aCtEm/eu1KhSLj2c9eFrylXZknQYmxUssFaVJKvvc0dJQixhGjG2yXWiV9Q==" crossorigin=""></script>
  <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/leaflet.markercluster@1.0.3/dist/leaflet.markercluster.js"></script>

  <script>
     function initGeolocation()
     {
        if( navigator.geolocation )
        {
           // Call getCurrentPosition with success and failure callbacks
           navigator.geolocation.getCurrentPosition( success, fail );
        }
        else
        {
           alert("Sorry, your browser does not support geolocation services.");
        }
     }
     function success(position)
     {
         document.getElementById('long').value = position.coords.longitude;
         document.getElementById('lat').value = position.coords.latitude
     }

     function fail()
     {
        // Could not obtain location
     }





     function startFunc()
     {
       let requestURL = 'https://gbfs.divvybikes.com/gbfs/en/free_bike_status.json';
       var rad = document.getElementById('radius').value;
       d3.json(requestURL).then(function(divvyData) {
         var tbody = d3.select("tbody");
         var allBikes = divvyData.data
         var bikearray = allBikes.bikes;
           const bikes = bikearray.filter(d => Math.abs(d.lon - document.getElementById('long').value) < (rad / 364300) && Math.abs(d.lat - document.getElementById('lat').value) < (rad / 364300));
           document.getElementById("bikelist").innerHTML = bikes.length;
         })
     }

   </script>
 </head>

 <body>
    <FORM NAME="rd" METHOD="POST" ACTION="index.html">
      <INPUT TYPE="button" NAME="locate" ID="locate" VALUE="Get Location" onClick="initGeolocation();">
      <INPUT TYPE="text" NAME="long" ID="long" VALUE="">
      <INPUT TYPE="text" NAME="lat" ID="lat" VALUE="">
      <br>
      <p>Radius (in ft | default = 1000):
      <INPUT TYPE="text" NAME="radius" ID="radius" VALUE="1000">
      <br><br>
      <INPUT TYPE="button" NAME="start" ID="start" VALUE="Start" onClick="startFunc();">
      </FORM>
      <p ID="bikelist"></p>
 </body>
</html>
